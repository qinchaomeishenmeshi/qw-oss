"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.defaultMultipartUploadParams = exports.default = void 0;
exports.multipartUpload = multipartUpload;
var _enum = require("../enum");
var _file2Hash = require("./file-2-hash");
var _getOssClient = require("./get-oss-client");
async function getUploadId(file, {
  client,
  name
}) {
  const res = await client.initMultipartUpload(`${name || file.name}`, {
    headers: {
      'Content-Type': file.type ?? 'application/octet-stream'
    }
  });
  console.log(res);
  return res.uploadId;
}
const defaultMultipartUploadParams = {
  dir: _enum.OssDirEnum.DEFAULT,
  chunkSize: 1024 * 1024,
  onProgress: (progress, loaded, total) => {}
};

/**
 * 分片上传。支持onProgress（进度查询）、断点续传、中断。
 * @param file
 * @param options
 * @returns
 * @example //不使用中断时的语法
 * await multipartUpload(file[, options])
 * @example //使用中断时的语法
 * const controller = multipartUpload(file[, options])
 * //异步触发abort函数
 * setTimeout(() => controller.abort(), 3000)
 * await controller
 */
exports.defaultMultipartUploadParams = defaultMultipartUploadParams;
const uploadLocalStorage = {
  get(key) {
    const name = localStorage.getItem(`uploadName:${key}`);
    const uploadId = +(localStorage.getItem(`uploadId:${key}`) || '');
    return {
      name,
      uploadId
    };
  },
  set(key, uploadId) {
    localStorage.setItem(`uploadId:${key}`, `${uploadId}`);
    localStorage.setItem(`uploadName:${key}`, key);
  },
  remove(key) {
    localStorage.removeItem(`uploadId:${key}`);
    localStorage.removeItem(`uploadName:${key}`);
  }
};
function multipartUpload(file, options = defaultMultipartUploadParams) {
  let abortController;
  const _upload = async () => {
    try {
      abortController = new AbortController();
    } catch (error) {
      abortController = undefined;
    }
    const {
      dir,
      chunkSize,
      onProgress
    } = {
      ...defaultMultipartUploadParams,
      ...options
    };
    const name = await (0, _file2Hash.file2OssName)(file, {
      dir,
      chunkLength: chunkSize
    });
    const detectAbort = () => {
      if (abortController && abortController.signal?.aborted) {
        uploadLocalStorage.remove(name);
        throw new Error('检测到中断触发');
      }
    };
    detectAbort();
    const client = await (0, _getOssClient.getOssClient)();
    const uploadId = await getUploadId(file, {
      client,
      name
    });
    uploadLocalStorage.set(name, `${uploadId}`);
    if (!uploadId) throw new Error('获取uploadId失败');
    const chunkLength = Math.ceil(file.size / chunkSize);
    const doneList = [];
    const parts = await client.listParts(name, uploadId.toString());
    const startIdx = +parts.nextPartNumberMarker || 0;
    if (startIdx > 0 && startIdx < chunkLength) {
      parts.parts.forEach(part => doneList.push({
        number: +part.PartNumber,
        etag: part.ETag
      }));
    }
    for (let i = startIdx; i < chunkLength; i++) {
      const start = chunkSize * i;
      const end = Math.min(start + chunkSize, file.size);
      const part = await client.uploadPart(name, uploadId.toString(), i + 1, file, start, end);
      console.log(`chunk size: ${end - start}`);
      console.log(`Upload part${i + 1} finished`);
      doneList.push({
        number: i + 1,
        etag: part.etag
      });
      onProgress(+(100 * end / file.size).toFixed(2), end, file.size);
      detectAbort();
    }
    // console.log(doneList)
    const uploadResult = await client.completeMultipartUpload(name, uploadId.toString(), doneList);
    console.log(uploadResult);
    uploadLocalStorage.remove(name);
    return uploadResult;
  };
  return {
    then(...args) {
      return _upload().then(...args);
    },
    abort() {
      if (abortController === undefined) {
        throw new Error('上传还未开始');
      } else if (!('AbortController' in globalThis)) {
        console.warn('当前浏览器缺乏AbortController支持');
      } else abortController.abort();
    }
  };
}
var _default = multipartUpload; // const a = multipartUpload(new File()));
// a.abort()
// const res = await a
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZXRVcGxvYWRJZCIsImZpbGUiLCJjbGllbnQiLCJuYW1lIiwicmVzIiwiaW5pdE11bHRpcGFydFVwbG9hZCIsImhlYWRlcnMiLCJ0eXBlIiwiY29uc29sZSIsImxvZyIsInVwbG9hZElkIiwiZGVmYXVsdE11bHRpcGFydFVwbG9hZFBhcmFtcyIsImRpciIsIk9zc0RpckVudW0iLCJERUZBVUxUIiwiY2h1bmtTaXplIiwib25Qcm9ncmVzcyIsInByb2dyZXNzIiwibG9hZGVkIiwidG90YWwiLCJ1cGxvYWRMb2NhbFN0b3JhZ2UiLCJnZXQiLCJrZXkiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2V0Iiwic2V0SXRlbSIsInJlbW92ZSIsInJlbW92ZUl0ZW0iLCJtdWx0aXBhcnRVcGxvYWQiLCJvcHRpb25zIiwiYWJvcnRDb250cm9sbGVyIiwiX3VwbG9hZCIsIkFib3J0Q29udHJvbGxlciIsImVycm9yIiwidW5kZWZpbmVkIiwiZmlsZTJPc3NOYW1lIiwiY2h1bmtMZW5ndGgiLCJkZXRlY3RBYm9ydCIsInNpZ25hbCIsImFib3J0ZWQiLCJFcnJvciIsImdldE9zc0NsaWVudCIsIk1hdGgiLCJjZWlsIiwic2l6ZSIsImRvbmVMaXN0IiwicGFydHMiLCJsaXN0UGFydHMiLCJ0b1N0cmluZyIsInN0YXJ0SWR4IiwibmV4dFBhcnROdW1iZXJNYXJrZXIiLCJmb3JFYWNoIiwicGFydCIsInB1c2giLCJudW1iZXIiLCJQYXJ0TnVtYmVyIiwiZXRhZyIsIkVUYWciLCJpIiwic3RhcnQiLCJlbmQiLCJtaW4iLCJ1cGxvYWRQYXJ0IiwidG9GaXhlZCIsInVwbG9hZFJlc3VsdCIsImNvbXBsZXRlTXVsdGlwYXJ0VXBsb2FkIiwidGhlbiIsImFyZ3MiLCJhYm9ydCIsImdsb2JhbFRoaXMiLCJ3YXJuIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliU3JjL3NyYy9tdWx0aXBhcnQtdXBsb2FkLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9zc0RpckVudW0gfSBmcm9tICcuLi9lbnVtJ1xuaW1wb3J0IHsgZmlsZTJPc3NOYW1lIH0gZnJvbSAnLi9maWxlLTItaGFzaCdcbmltcG9ydCB7IGdldE9zc0NsaWVudCB9IGZyb20gJy4vZ2V0LW9zcy1jbGllbnQnXG5cbnR5cGUgT3NzVXBsb2FkUmVzcG9uc2UgPSB7XG4gIG5hbWU6IHN0cmluZ1xuICB1cmw6IHN0cmluZ1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRVcGxvYWRJZChmaWxlOiBGaWxlLCB7IGNsaWVudCwgbmFtZSB9OiB7IGNsaWVudDogYW55OyBuYW1lPzogc3RyaW5nIH0pIHtcbiAgY29uc3QgcmVzID0gYXdhaXQgY2xpZW50LmluaXRNdWx0aXBhcnRVcGxvYWQoYCR7bmFtZSB8fCBmaWxlLm5hbWV9YCwge1xuICAgIGhlYWRlcnM6IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiBmaWxlLnR5cGUgPz8gJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScsXG4gICAgfSxcbiAgfSlcbiAgY29uc29sZS5sb2cocmVzKVxuICByZXR1cm4gcmVzLnVwbG9hZElkIGFzIG51bWJlclxufVxuXG50eXBlIE11bHRpcGFydFVwbG9hZFBhcmFtcyA9IFBhcnRpYWw8dHlwZW9mIGRlZmF1bHRNdWx0aXBhcnRVcGxvYWRQYXJhbXM+XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0TXVsdGlwYXJ0VXBsb2FkUGFyYW1zID0ge1xuICBkaXI6IE9zc0RpckVudW0uREVGQVVMVCxcbiAgY2h1bmtTaXplOiAxMDI0ICogMTAyNCxcbiAgb25Qcm9ncmVzczogKHByb2dyZXNzOiBudW1iZXIsIGxvYWRlZDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKSA9PiB7fSxcbn1cblxuLyoqXG4gKiDliIbniYfkuIrkvKDjgILmlK/mjIFvblByb2dyZXNz77yI6L+b5bqm5p+l6K+i77yJ44CB5pat54K557ut5Lyg44CB5Lit5pat44CCXG4gKiBAcGFyYW0gZmlsZVxuICogQHBhcmFtIG9wdGlvbnNcbiAqIEByZXR1cm5zXG4gKiBAZXhhbXBsZSAvL+S4jeS9v+eUqOS4reaWreaXtueahOivreazlVxuICogYXdhaXQgbXVsdGlwYXJ0VXBsb2FkKGZpbGVbLCBvcHRpb25zXSlcbiAqIEBleGFtcGxlIC8v5L2/55So5Lit5pat5pe255qE6K+t5rOVXG4gKiBjb25zdCBjb250cm9sbGVyID0gbXVsdGlwYXJ0VXBsb2FkKGZpbGVbLCBvcHRpb25zXSlcbiAqIC8v5byC5q2l6Kem5Y+RYWJvcnTlh73mlbBcbiAqIHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCAzMDAwKVxuICogYXdhaXQgY29udHJvbGxlclxuICovXG5jb25zdCB1cGxvYWRMb2NhbFN0b3JhZ2UgPSB7XG4gIGdldChrZXk6IHN0cmluZykge1xuICAgIGNvbnN0IG5hbWUgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShgdXBsb2FkTmFtZToke2tleX1gKSBhcyBzdHJpbmdcbiAgICBjb25zdCB1cGxvYWRJZCA9ICsobG9jYWxTdG9yYWdlLmdldEl0ZW0oYHVwbG9hZElkOiR7a2V5fWApIHx8ICcnKVxuICAgIHJldHVybiB7XG4gICAgICBuYW1lLFxuICAgICAgdXBsb2FkSWQsXG4gICAgfVxuICB9LFxuICBzZXQoa2V5OiBzdHJpbmcsIHVwbG9hZElkOiBzdHJpbmcpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdXBsb2FkSWQ6JHtrZXl9YCwgYCR7dXBsb2FkSWR9YClcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgdXBsb2FkTmFtZToke2tleX1gLCBrZXkpXG4gIH0sXG4gIHJlbW92ZShrZXk6IHN0cmluZykge1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB1cGxvYWRJZDoke2tleX1gKVxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGB1cGxvYWROYW1lOiR7a2V5fWApXG4gIH0sXG59XG5leHBvcnQgZnVuY3Rpb24gbXVsdGlwYXJ0VXBsb2FkKGZpbGU6IEZpbGUsIG9wdGlvbnM6IE11bHRpcGFydFVwbG9hZFBhcmFtcyA9IGRlZmF1bHRNdWx0aXBhcnRVcGxvYWRQYXJhbXMpIHtcbiAgbGV0IGFib3J0Q29udHJvbGxlcjogQWJvcnRDb250cm9sbGVyIHwgdW5kZWZpbmVkXG4gIGNvbnN0IF91cGxvYWQgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBhYm9ydENvbnRyb2xsZXIgPSB1bmRlZmluZWRcbiAgICB9XG5cbiAgICBjb25zdCB7IGRpciwgY2h1bmtTaXplLCBvblByb2dyZXNzIH0gPSB7XG4gICAgICAuLi5kZWZhdWx0TXVsdGlwYXJ0VXBsb2FkUGFyYW1zLFxuICAgICAgLi4ub3B0aW9ucyxcbiAgICB9XG5cbiAgICBjb25zdCBuYW1lID0gYXdhaXQgZmlsZTJPc3NOYW1lKGZpbGUsIHtcbiAgICAgIGRpcixcbiAgICAgIGNodW5rTGVuZ3RoOiBjaHVua1NpemUsXG4gICAgfSlcblxuICAgIGNvbnN0IGRldGVjdEFib3J0ID0gKCkgPT4ge1xuICAgICAgaWYgKGFib3J0Q29udHJvbGxlciAmJiBhYm9ydENvbnRyb2xsZXIuc2lnbmFsPy5hYm9ydGVkKSB7XG4gICAgICAgIHVwbG9hZExvY2FsU3RvcmFnZS5yZW1vdmUobmFtZSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfmo4DmtYvliLDkuK3mlq3op6blj5EnKVxuICAgICAgfVxuICAgIH1cbiAgICBkZXRlY3RBYm9ydCgpXG5cbiAgICBjb25zdCBjbGllbnQgPSBhd2FpdCBnZXRPc3NDbGllbnQoKVxuICAgIGNvbnN0IHVwbG9hZElkID0gYXdhaXQgZ2V0VXBsb2FkSWQoZmlsZSwge1xuICAgICAgY2xpZW50LFxuICAgICAgbmFtZSxcbiAgICB9KVxuICAgIHVwbG9hZExvY2FsU3RvcmFnZS5zZXQobmFtZSwgYCR7dXBsb2FkSWR9YClcbiAgICBpZiAoIXVwbG9hZElkKSB0aHJvdyBuZXcgRXJyb3IoJ+iOt+WPlnVwbG9hZElk5aSx6LSlJylcbiAgICBjb25zdCBjaHVua0xlbmd0aCA9IE1hdGguY2VpbChmaWxlLnNpemUgLyBjaHVua1NpemUpXG4gICAgY29uc3QgZG9uZUxpc3QgPSBbXVxuICAgIGNvbnN0IHBhcnRzID0gYXdhaXQgY2xpZW50Lmxpc3RQYXJ0cyhuYW1lLCB1cGxvYWRJZC50b1N0cmluZygpKVxuICAgIGNvbnN0IHN0YXJ0SWR4ID0gK3BhcnRzLm5leHRQYXJ0TnVtYmVyTWFya2VyIHx8IDBcbiAgICBpZiAoc3RhcnRJZHggPiAwICYmIHN0YXJ0SWR4IDwgY2h1bmtMZW5ndGgpIHtcbiAgICAgIHBhcnRzLnBhcnRzLmZvckVhY2goKHBhcnQ6IHsgUGFydE51bWJlcjogbnVtYmVyOyBFVGFnOiBzdHJpbmcgfSkgPT5cbiAgICAgICAgZG9uZUxpc3QucHVzaCh7IG51bWJlcjogK3BhcnQuUGFydE51bWJlciwgZXRhZzogcGFydC5FVGFnIH0pXG4gICAgICApXG4gICAgfVxuICAgIGZvciAobGV0IGkgPSBzdGFydElkeDsgaSA8IGNodW5rTGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gY2h1bmtTaXplICogaVxuICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4oc3RhcnQgKyBjaHVua1NpemUsIGZpbGUuc2l6ZSlcbiAgICAgIGNvbnN0IHBhcnQgPSBhd2FpdCBjbGllbnQudXBsb2FkUGFydChuYW1lLCB1cGxvYWRJZC50b1N0cmluZygpLCBpICsgMSwgZmlsZSwgc3RhcnQsIGVuZClcbiAgICAgIGNvbnNvbGUubG9nKGBjaHVuayBzaXplOiAke2VuZCAtIHN0YXJ0fWApXG4gICAgICBjb25zb2xlLmxvZyhgVXBsb2FkIHBhcnQke2kgKyAxfSBmaW5pc2hlZGApXG4gICAgICBkb25lTGlzdC5wdXNoKHsgbnVtYmVyOiBpICsgMSwgZXRhZzogcGFydC5ldGFnIH0pXG4gICAgICBvblByb2dyZXNzKCsoKDEwMCAqIGVuZCkgLyBmaWxlLnNpemUpLnRvRml4ZWQoMiksIGVuZCwgZmlsZS5zaXplKVxuICAgICAgZGV0ZWN0QWJvcnQoKVxuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZyhkb25lTGlzdClcbiAgICBjb25zdCB1cGxvYWRSZXN1bHQgPSBhd2FpdCBjbGllbnQuY29tcGxldGVNdWx0aXBhcnRVcGxvYWQobmFtZSwgdXBsb2FkSWQudG9TdHJpbmcoKSwgZG9uZUxpc3QpXG4gICAgY29uc29sZS5sb2codXBsb2FkUmVzdWx0KVxuICAgIHVwbG9hZExvY2FsU3RvcmFnZS5yZW1vdmUobmFtZSlcbiAgICByZXR1cm4gdXBsb2FkUmVzdWx0XG4gIH1cbiAgcmV0dXJuIHtcbiAgICB0aGVuKC4uLmFyZ3M6IGFueVtdKSB7XG4gICAgICByZXR1cm4gX3VwbG9hZCgpLnRoZW4oLi4uYXJncylcbiAgICB9LFxuICAgIGFib3J0KCkge1xuICAgICAgaWYgKGFib3J0Q29udHJvbGxlciA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcign5LiK5Lyg6L+Y5pyq5byA5aeLJylcbiAgICAgIH0gZWxzZSBpZiAoISgnQWJvcnRDb250cm9sbGVyJyBpbiBnbG9iYWxUaGlzKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ+W9k+WJjea1j+iniOWZqOe8uuS5j0Fib3J0Q29udHJvbGxlcuaUr+aMgScpXG4gICAgICB9IGVsc2UgYWJvcnRDb250cm9sbGVyLmFib3J0KClcbiAgICB9LFxuICB9IGFzIFByb21pc2VMaWtlPE9zc1VwbG9hZFJlc3BvbnNlPiAmIHsgYWJvcnQ6ICgpID0+IHZvaWQgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBtdWx0aXBhcnRVcGxvYWRcblxuLy8gY29uc3QgYSA9IG11bHRpcGFydFVwbG9hZChuZXcgRmlsZSgpKSk7XG4vLyBhLmFib3J0KClcbi8vIGNvbnN0IHJlcyA9IGF3YWl0IGFcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQU9BLGVBQWVBLFdBQVcsQ0FBQ0MsSUFBVSxFQUFFO0VBQUVDLE1BQU07RUFBRUM7QUFBcUMsQ0FBQyxFQUFFO0VBQ3ZG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